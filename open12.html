<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title></title>
    <style></style>
    <script></script>
</head>

<body>
    <h2>나의 단어장 만들기</h2>
    <hr>
    <form>
        <fieldset>
            <legend>로컬스토리지 단어장</legend>
            영어 <input type="text" id="en"><br>
            한글 <input type="text" id="ko"><br><br>
            <button type="button" onclick="store(event)">단어저장</button>
            <button type="button" onclick="retrieve(event)">영단어 검색</button>
            <button type="button" onclick="wordDelete(event)">단어 삭제</button>
            <button type="button" onclick="printAll(event)">전체보기</button>
            <button type="button" onclick="window.localStorage.clear()">초기화</button>
        </fieldset>
    </form>
    <script>
        var enWord = document.getElementById("en");
        var koMeaning = document.getElementById("ko");
        var win=null;

        function store() {
            if (!window.localStorage) {
                alert("로컬스토리지를 지원하지 않습니다.");
                return;
            }

            if(window.localStorage.getItem(enWord.value)){
                var choice = confirm(enWord.value + "가 이미 있습니다. 수정하시겠습니까?");
                if(choice)
                    window.localStorage.setItem(enWord.value, koMeaning.value);

                return;                
            }else
                window.localStorage.setItem(enWord.value, koMeaning.value);
        }
        function retrieve(){
            if (!window.localStorage) {
                alert("로컬스토리지를 지원하지 않습니다.");
                return;
            }
            var val = window.localStorage.getItem(enWord.value);
            if(val == null)
                alert(enWord.value + "는 없는 단어입니다.");
            else
                koMeaning.value = val;
        }
        function wordDelete(){
            if(window.localStorage.getItem(enWord.value))
                window.localStorage.removeItem(enWord.value);
            else
                alert(enWord.value + "는 없는 단어입니다.")
        }
        function printAll(){
            var wordList="<h2>나의 단어장 모두 출력</h2><hr><table>";
            var key, val;
            for(var i=0;i<window.localStorage.length;i++){
                key = window.localStorage.key(i);
                val = window.localStorage.getItem(key);
                if(val == null)
                    break;
                wordList += "<tr><td><span>" + (i+1) + "</span></td>" + "<td class='key'>" + key + "</td><td>" + val +"</td></tr>";   
            }
            wordList+="</table>";

            if(win != null)
                win.close();
            win = window.open("","wordList","left=400, top=500, width=400, height=500 resizable, scrollbars");
            win.document.title="단어장";
            win.document.write(wordList);

            var table = win.document.getElementsByTagName("table")[0];
            table.style.backgroundColor="aliceblue";


            var styleDom = win.document.getElementsByTagName("style")[0];
            var sheet = 'body{background-color:black;} .key{font-weight:bold;}';
            styleDom.innerHTML= sheet;
        }
        printAll();
    </script>
</body>

</html>